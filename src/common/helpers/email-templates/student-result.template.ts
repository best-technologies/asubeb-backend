export interface StudentResultEmailItem {
  subjectName: string;
  score: number;
  maxScore: number;
  percentage: number;
  type: string;
}

export interface StudentResultEmailPayload {
  studentName: string;
  studentId: string;
  gender?: string | null;
  schoolName?: string | null;
  className?: string | null;
  sessionName: string;
  termName: string;
  assessments: StudentResultEmailItem[];
}

export const studentResultEmailTemplate = (payload: StudentResultEmailPayload): string => {
  const totalScore = payload.assessments.reduce((s, a) => s + a.score, 0);
  const totalMax = payload.assessments.reduce((s, a) => s + a.maxScore, 0);
  const overallPct = totalMax > 0 ? Math.round(((totalScore / totalMax) * 100) * 100) / 100 : 0;

  const rows = payload.assessments.map(a => `
    <tr>
      <td style="padding: 8px 12px; border: 1px solid #eee;">${a.subjectName}</td>
      <td style="padding: 8px 12px; border: 1px solid #eee;">${a.type}</td>
      <td style="padding: 8px 12px; border: 1px solid #eee;">${a.score}</td>
      <td style="padding: 8px 12px; border: 1px solid #eee;">${a.maxScore}</td>
      <td style="padding: 8px 12px; border: 1px solid #eee;">${a.percentage}</td>
    </tr>
  `).join('');

  return `
  <div style="font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; color: #1f2937;">
    <div style="max-width: 640px; margin: 0 auto; border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden;">
      <div style="background: linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%); padding: 20px; color: white;">
        <h2 style="margin:0;">Student Result</h2>
        <p style="margin: 4px 0 0 0; opacity: 0.9;">Session ${payload.sessionName} • ${payload.termName.replace('_', ' ')}</p>
      </div>
      <div style="padding: 20px;">
        <p style="margin: 0 0 12px 0; font-weight: 600;">${payload.studentName} <span style="font-weight: 400; color: #6b7280">(${payload.studentId})</span></p>
        <p style="margin: 0 0 8px 0; color: #6b7280;">${payload.gender ?? 'N/A'} • ${payload.schoolName ?? 'N/A'} • ${payload.className ?? 'N/A'}</p>

        <table style="border-collapse: collapse; width: 100%; margin-top: 12px;">
          <thead>
            <tr>
              <th align="left" style="padding: 10px 12px; background: #f3f4f6; border: 1px solid #eee;">Subject</th>
              <th align="left" style="padding: 10px 12px; background: #f3f4f6; border: 1px solid #eee;">Type</th>
              <th align="left" style="padding: 10px 12px; background: #f3f4f6; border: 1px solid #eee;">Score</th>
              <th align="left" style="padding: 10px 12px; background: #f3f4f6; border: 1px solid #eee;">Max</th>
              <th align="left" style="padding: 10px 12px; background: #f3f4f6; border: 1px solid #eee;">%</th>
            </tr>
          </thead>
          <tbody>
            ${rows || `<tr><td colspan="5" style="padding: 12px; border: 1px solid #eee; color: #6b7280;">No assessments</td></tr>`}
          </tbody>
        </table>

        <div style="margin-top: 16px; padding: 12px; background: #f9fafb; border: 1px solid #eee; border-radius: 6px;">
          <p style="margin: 0;">Total: <strong>${totalScore}</strong> / ${totalMax} • Overall: <strong>${overallPct}%</strong></p>
        </div>

        <p style="margin-top: 24px; color: #6b7280; font-size: 12px;">Generated by ASUBEB</p>
      </div>
    </div>
  </div>`;
};


